---
title: "Neovim ã§ SATySFi ã®ç·¨é›†ç’°å¢ƒã‚’ç°¡å˜ã«è¨­å®šã™ã‚‹"
emoji: "ğŸš€"
type: "tech"
topics: ["Neovim", "SATySFi", "lspconfig", "treesitter"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯ [SATySFi ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ 2023](https://adventar.org/calendars/9214) 17æ—¥ç›®ã®è¨˜äº‹ã§ã™
:::

## æ¦‚è¦

[SATySFi](https://github.com/gfngfn/SATySFi) ã¯ gfngfn æ°ãŒé–‹ç™ºã•ã‚Œã¦ã„ã‚‹æ¯”è¼ƒçš„æ–°ã—ã„çµ„ç‰ˆè¨€èªã§ã€ã“ã®åˆ†é‡ã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã¨ã‚‚è¨€ãˆã‚‹ TeX ã¨æ¯”ã¹ã¦å‹ä»˜ãè¨€èªã§ã‚ã‚‹ã“ã¨ã‚’ç‰¹å¾´ã¨ã—ã¦ã„ã¾ã™ã€‚
å‹ãŒä»˜ã„ã¦ã„ã‚‹ã“ã¨ã§è¤‡é›‘ãªçµ„ç‰ˆå‡¦ç†ã«å¯¾ã—ã¦ã‚‚æ¯”è¼ƒçš„é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ã‚’å‡ºåŠ›ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€é–‹ç™ºè€…ã«ã¨ã£ã¦ã‚‚åˆ©ç”¨è€…ã«ã¨ã£ã¦ã‚‚ä½“é¨“ãŒè‰¯ããªã‚Šã¾ã™ã€‚

ã“ã® SATySFi ã¨ã„ã†è¨€èªã«ã¤ã„ã¦ã€ç·¨é›†ç’°å¢ƒã‚’è‰¯ãã™ã‚‹ãŸã‚ã« [language server](https://github.com/monaqa/satysfi-language-server) ã‚„ [tree-sitter parser](https://github.com/monaqa/tree-sitter-satysfi) ãŒã¤ãã‚‰ã‚Œã¦ã„ã¾ã™ (ã©ã¡ã‚‰ã‚‚ monaqa æ°ãŒé–‹ç™ºã•ã‚Œã¦ã„ã¾ã™)ã€‚
ã“ã‚Œã‚‰ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§åŸ·ç­†ã®æœ€ä¸­ã«ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚„ã‚¨ãƒ©ãƒ¼è¨ºæ–­ã«ã‚ˆã‚‹æ©æµã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã—ã‹ã—ã€ã“ã‚Œã‚‰ã® language server ã‚„ tree-sitter parser ã¯æ¨™æº–çš„ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯è¨­å®šãŒæä¾›ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ä½¿ã„å§‹ã‚ã‚‹ãŸã‚ã«ã‚„ã‚„è¾¼ã¿å…¥ã£ãŸçŸ¥è­˜ã‚„è¿½åŠ ã®è¨­å®šãŒå¿…è¦ã«ãªã‚‹ã“ã¨ãŒé›£ç‚¹ã§ã™ã€‚ä»Šå›ã¯ã“ã®èª²é¡Œã‚’è§£æ¶ˆã™ã‚‹ãŸã‚ã€è¨­å®šæƒ…å ±ã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦ã¾ã¨ã‚ã‚‹ã“ã¨ã§ç°¡å˜ã«ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’å°å…¥ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

### ç›®æ¨™

Neovim ä¸Šã§ SATySFi ã®ç·¨é›†ç’°å¢ƒã‚’æ‰‹è»½ã«è¨­å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨

### èª¬æ˜ã—ãªã„ã“ã¨

Language server protocol ã‚„ tree-sitter è‡ªä½“ã®èª¬æ˜ã¯ã“ã®è¨˜äº‹ã§ã¯è¡Œã„ã¾ã›ã‚“ã€‚å‚è€ƒè¨˜äº‹ã‚’ã„ãã¤ã‹æŒ™ã’ã¾ã™ã®ã§ãã¡ã‚‰ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

## ã¤ãã£ãŸã‚‚ã®

Language server ãŠã‚ˆã³ tree-sitter ã®è¨­å®šã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã¨ã—ã¦æ¬¡ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚
ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€[`nvim-lspconfig`](https://github.com/neovim/nvim-lspconfig) ã‚„ [`nvim-treesitter`](https://github.com/nvim-treesitter/nvim-treesitter) ã®æ¨™æº–çš„ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ satysfi ã® language server ã‚„ tree-sitter parser ã‚’æ‰±ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

https://github.com/sankantsu/satysfi.nvim

ã¾ãŸ`satysfi-language-server` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚‚ã€ neovim ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹ language server ç³»ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã§ã‚ã‚‹ [`mason.nvim`](https://github.com/williamboman/mason.nvim) çµŒç”±ã§è¡Œãˆã‚‹ã¨ä¾¿åˆ©ã ã‚ã†ã¨ã„ã†ã“ã¨ã§ã€æ¬¡ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

https://github.com/sankantsu/satysfi-mason-registry

ã“ã¡ã‚‰ã¯æ‰‹å…ƒã«ã‚½ãƒ¼ã‚¹ã‚’ã‚‚ã£ã¦ãã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€`mason.nvim` ã®è¨­å®šã§ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¨ã—ã¦è¿½åŠ ã™ã‚‹ã“ã¨ã§ `satysfi-language-parser` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒè¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## è¨­å®šæ–¹æ³•

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã«ã¤ã„ã¦ã¯ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ã«åˆã‚ã›ã¦ç½®ãã‹ãˆã¦ãã ã•ã„ã€‚ã“ã“ã§ã¯ `lazy.nvim` ã‚’ä¾‹ã«ã—ã¾ã™ã€‚
æœ€ä½é™ã®è¨­å®šãªã‚‰ä»¥ä¸‹ã§ååˆ†ã§ã™ã€‚

```lua
require("lazy").setup({
  "neovim/nvim-lspconfig",
  { "nvim-treesitter/nvim-treesitter", build = ":TSUpdate"},
  "sankantsu/satysfi.nvim",
})

require("satysfi-nvim").setup()
require("lspconfig").satysfi_ls.setup {}
```

ã“ã®æ™‚ç‚¹ã§ã€ä»¥ä¸‹ã¯é”æˆã•ã‚Œã¾ã™ã€‚

- `satysfi-language-server` ãŒ (PATH ãŒé€šã£ã¦ã„ã‚‹å ´æ‰€ã«) ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚Œã°ã€SATySFi ã®ãƒ•ã‚¡ã‚¤ãƒ« (`*.saty` ç­‰) ç·¨é›†æ™‚ã«è‡ªå‹•ã§ç«‹ã¡ã‚ãŒã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚
- `:TSInstall satysfi` ã§ SATySFi ã® tree-sitter parser ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã€‚

`mason.nvim` çµŒç”±ã§ `satysfi-language-parser` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆã¯æ¬¡ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

```lua
require("lazy").setup({
  -- (ç•¥)
  "williamboman/mason.nvim",
})

require("mason").setup {
  registries = {
    "github:sankantsu/satysfi-mason-registry",
    "github:mason-org/mason-registry",
  },
}
```

ã“ã®ã‚ˆã†ã«ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ `:Mason` ã§è¡¨ç¤ºã•ã‚Œã‚‹ä¸€è¦§ãªã©ã« `satysfi-language-server` ãŒå‡ºã¦ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã•ã‚‰ã«è¨­å®šã« [`mason-lspconfig`](https://github.com/williamboman/mason-lspconfig.nvim) ã‚’ç”¨ã„ã¦ã„ã‚‹å ´åˆã§ã‚ã‚Œã°ã€`ensure_installed` ã‚„ automatic server setup ã®æ©Ÿèƒ½ã¨é€£æºã§ãã¾ã™ã€‚
ä»¥ä¸Šã‚’ã‚‚ã¨ã«å…¨ä½“ã‚’ã¾ã¨ã‚ãŸè¨­å®šã®ä¸€ä¾‹ã‚’ç¤ºã—ã¾ã™ã®ã§ã”å‚è€ƒã«ã©ã†ãã€‚

:::details è¨­å®šä¾‹ã®ã¾ã¨ã‚
```lua
-- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (ä½¿ã£ã¦ã„ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ã”ã¨ã«å¤‰æ›´)
require("lazy").setup({
  "neovim/nvim-lspconfig",
  { "nvim-treesitter/nvim-treesitter", build = ":TSUpdate"},
  "williamboman/mason.nvim",
  "williamboman/mason-lspconfig.nvim",
  "sankantsu/satysfi.nvim",
})

-- satysfi ç”¨ã® lspconfig ãŠã‚ˆã³ tree-sitter ã®è¨­å®šã‚’ç™»éŒ²
require("satysfi-nvim").setup()

-- mason ã® satysfi-language-server ç”¨ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’è¿½åŠ 
require("mason").setup {
  registries = {
    "github:sankantsu/satysfi-mason-registry",
    "github:mason-org/mason-registry",
  },
}
-- satysfi-language-server ãŒå¿…ãšã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
require('mason-lspconfig').setup {
  ensure_installed = { "satysfi_ls", },
}
-- language server ã®è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— (satysfi_ls ã‚‚å‹æ‰‹ã« setup ã•ã‚Œã‚‹)
require('mason-lspconfig').setup_handlers({ function(server)
  require('lspconfig')[server].setup {}
end })

-- treesitter
-- tree-sitter-satysfi ã‚’å¿…ãš install + syntax highlight ã‚’æœ‰åŠ¹åŒ–
require("nvim-treesitter.configs").setup {
  ensure_installed = {
    "satysfi",
  },
  highlight = {
    enable = true,
  },
}
```
:::

## ãŠã‚ã‚Šã«

æœ¬è¨˜äº‹ã§ã¯ Neovim ä¸Šã§ SATySFi ã®åŸ·ç­†ç’°å¢ƒã‚’ç°¡å˜ã«æ•´ãˆã‚‹ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç´¹ä»‹ã¨è¨­å®šæ–¹æ³•ã®èª¬æ˜ã‚’ã—ã¾ã—ãŸã€‚ã“ã‚Œã‚’ãã£ã‹ã‘ã« SATySFi ãŒã‚‚ã£ã¨æ‰‹è»½ã«ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦åˆ©ç”¨ãŒåºƒãŒã‚‹ã¨è‰¯ã„ãªã¨æ€ã„ã¾ã™ï¼

## å‚è€ƒè¨˜äº‹

monaqa ã•ã‚“ã«ã‚ˆã‚‹ `satysfi-language-parser` ã®ç´¹ä»‹è¨˜äº‹ã§ã™ã€‚

https://zenn.dev/monaqa/articles/2021-12-10-satysfi-language-server

LSP è‡ªä½“ã«ã¤ã„ã¦åŸºç¤çš„ãªéƒ¨åˆ†ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’ä»¥å‰æ›¸ãã¾ã—ãŸã€‚

https://zenn.dev/vim_jp/articles/40b2c348386f88

LSP ã®ä¸€èˆ¬çš„ãªè¨­å®šæ–¹æ³•ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ãªã©ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

https://zenn.dev/nazo6/articles/c2f16b07798bab

Treesitter ã¾ã‚ã‚Šã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®2è¨˜äº‹ã‚’æŒ™ã’ã¦ãŠãã¾ã™ã€‚

https://zenn.dev/monaqa/articles/2021-12-22-vim-nvim-treesitter-highlight
https://zenn.dev/duglaser/articles/c02d6a937a48df
