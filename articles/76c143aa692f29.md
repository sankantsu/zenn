---
title: "ã€Numpyã€‘indexing ã¨ broadcasting ã‚’ç›´æ„Ÿçš„ã«ç†è§£ã—ãŸã„"
emoji: "ğŸ§±"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Numpy", "Python"]
published: true
---

## ã¯ã˜ã‚ã«

Numpy ã® indexing ã£ã¦ãªã‹ãªã‹ã«è¤‡é›‘ã§ã€æ··ä¹±ã—ãŸçµŒé¨“ã¯ç„¡ã„ã§ã—ã‚‡ã†ã‹?
ä¾‹ãˆã°ã€ã“ã‚“ãª numpy æ“ä½œã‚’è¦‹ã¦çµæœãŒã™ãã«äºˆæ¸¬ã§ãã‚‹ã§ã—ã‚‡ã†ã‹?

```python
import numpy as np
a = np.arange(24).reshape(2, 3, 4)
b = np.array([10, 20])
res = a[0, ..., 1, np.newaxis] + b
# res.shape ã¯? ä¸­èº«ã¯?
```

(ç­”ãˆã¯æœ«å°¾ã® Quiz ã«ã‚ã‚Šã¾ã™)

æ©Ÿæ¢°å­¦ç¿’ (ML) ç³»ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã¯å¿…ãšã¨ã„ã£ã¦ã„ã„ã»ã© Numpy ã‚„ PyTorch ã®ãƒ†ãƒ³ã‚½ãƒ«ã‚’æ‰±ã„ã¾ã™ãŒã€ãƒ†ãƒ³ã‚½ãƒ«ã®å½¢çŠ¶ã‚„ broadcasting ã®å‹•ããŒç†è§£ã§ããªã„ã“ã¨ãŒãã£ã‹ã‘ã§ã€ä½•ã‚’ã‚„ã£ã¦ã„ã‚‹ã®ã‹ã‚ˆãã‚ã‹ã‚‰ãªããªã£ã¦ã—ã¾ã†ã“ã¨ãŒç­†è€…ã¯ã‚ˆãã‚ã‚Šã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€åŸºæœ¬çš„ãª indexing, broadcasting æ“ä½œã«ã¤ã„ã¦ç‰¹ã«çµæœã®ãƒ†ãƒ³ã‚½ãƒ«ã® shape ã«æ³¨ç›®ã—ã¦ç›´æ„Ÿçš„ã«ç†è§£ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚
å½¢çŠ¶ã•ãˆã‚ã‹ã£ã¦ã—ã¾ãˆã°ã€å„ä½ç½®ã«ã©ã®å€¤ãŒå…¥ã‚‹ã‹ã¯ã•ã»ã©è¿·ã‚ãªã„ã¯ãšã§ã™ã€‚

## è¨˜äº‹ã®å†…å®¹

Indexing ã«è¡¨ã‚ã‚Œã‚‹ä»¥ä¸‹ã®è¦ç´ ã‚’èª¬æ˜ã—ã¾ã™

- æ•´æ•° (e.g. `2`)
- `:`
- `...`
- `None` (`np.newaxis`)

ã“ã®è¨˜äº‹ã§ã¯ã€ä»¥ä¸‹ã®ç‚¹ã«æ³¨ç›®ã—ã¦ indexing ã®çµæœã‚’ç°¡æ½”ã«èª¬æ˜ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™

- çµæœã®ãƒ†ãƒ³ã‚½ãƒ«ã® shape
- indexing å‰å¾Œã®æ¬¡å…ƒã®å¯¾å¿œ

ã¾ãŸã€æœ€å¾Œã« broadcasting ã«ãŠã‘ã‚‹æ¬¡å…ƒã®æ‹¡å¼µã®è€ƒãˆæ–¹ã‚’ç°¡å˜ã«èª¬æ˜ã—ã¾ã™ã€‚

### Reference

- https://numpy.org/doc/stable/user/basics.indexing.html
- https://numpy.org/doc/stable/user/basics.broadcasting.html

ã“ã®è¨˜äº‹ã§èª¬æ˜ã™ã‚‹ indexing ã¯ã€ reference ("Indexing on ndarrays") ã® "Basic Indexing" (ã‚’ã‚„ã‚„ç°¡ç•¥åŒ–ã—ãŸã‚‚ã®) ã«ãŠãŠã‚€ã­å¯¾å¿œã—ã¾ã™ã€‚
ã»ã‹ã® indexing ã®æ–¹æ³• (e.g. multidimensional array, boolean array) ç­‰ã«ã¤ã„ã¦ã¯ reference ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

:::message
ã“ã®è¨˜äº‹ã¯å³å¯†ã•ã‚ˆã‚Šã‚‚ç›´æ„Ÿçš„ãªç†è§£ã—ã‚„ã™ã•ã‚’é‡è¦–ã—ã¦æ›¸ã„ã¦ã„ã¾ã™ã€‚
ã‚‚ã—é–“é•ã„ãŒå«ã¾ã‚Œã‚‹ç®‡æ‰€ãŒã‚ã‚Œã°ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚
:::

### Python ã®ä¾‹ã«ã¤ã„ã¦

```python
import numpy as np
```

ã«ã‚ˆã‚Šã€ `np` ã¨ã„ã†åå‰ã§ numpy ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‚ç…§ã§ãã‚‹çŠ¶æ…‹ã‚’å‰æã¨ã—ã¾ã™

### ç’°å¢ƒ

è¨˜äº‹ä¸­ã®ä¾‹ã¯ä»¥ä¸‹ã®ç’°å¢ƒã§æ¤œè¨¼ã—ã¦ã„ã¾ã™

- Numpy 2.4.2

ã“ã®è¨˜äº‹ã®å†…å®¹ã«ã¤ã„ã¦ã€ Numpy ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³é–“ã§å¤§ããªå·®ã¯ç„¡ã„ã¨æƒ³å®šã—ã¦ã„ã¾ã™

## Indexing ã®åŸºæœ¬çš„ãªæ§‹é€ 

N æ¬¡å…ƒãƒ†ãƒ³ã‚½ãƒ«ã«å¯¾ã—ã¦ã€ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§ N è¦ç´ ã¾ã§ã® index ã‚’æŒ‡å®šã—ã¦ indexing ã§ãã¾ã™ã€‚

- ä¾‹

```python
>>> a = np.array([[0, 1, 2], [3, 4, 5]])
>>> a.shape
(2, 3)
>>> print(a[0, 2])
2
```

ã“ã“ã§ã¯ã€ `(0, 2)` ã«ã‚ˆã£ã¦ `a` ã‚’ indexing ã—ã¦ã„ã¾ã™ã€‚
`0` ã¯æœ€åˆã®æ¬¡å…ƒã‹ã‚‰å¯¾å¿œã™ã‚‹è¦ç´ ã‚’é¸ã³ã€ `2` ã¯æ¬¡ã®æ¬¡å…ƒã‹ã‚‰å¯¾å¿œã™ã‚‹è¦ç´ ã‚’é¸ã³ã¾ã™ã€‚

## `:` ã«ã‚ˆã‚‹ indexing

æ•´æ•°ã«ã‚ˆã‚‹ indexing ã§ã¯å¯¾å¿œã™ã‚‹æ¬¡å…ƒã‹ã‚‰ 1 è¦ç´ ã ã‘ã‚’é¸ã‚“ã§ã„ã¾ã—ãŸãŒã€ `:` ã¯å¯¾å¿œã™ã‚‹æ¬¡å…ƒã®å…¨ã¦ã®è¦ç´ ã‚’é¸ã³ã¾ã™ã€‚

- ä¾‹

```python
>>> a = np.array([[0, 1, 2], [3, 4, 5]])
>>> a[:, 1] # 0 ç•ªç›®ã®æ¬¡å…ƒã¯å…¨ã¦ã€1 ç•ªç›®ã®æ¬¡å…ƒã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ 1 ã®ã¿
array([1, 4])
>>> a[:, 1].shape
(2,)
```

## `...` ã«ã‚ˆã‚‹ indexing

`...` ã¯æ•´æ•°ã‚„ `:` ã«ã‚ˆã‚‹ indexing ã§ä½¿ã‚ã‚Œãšã«æ®‹ã£ãŸæ¬¡å…ƒã®æ•°ã® `:` ã«å±•é–‹ã•ã‚Œã¾ã™

- ä¾‹

```python
>>> a = np.ones((2, 3, 4, 5))
>>> a[0, ..., 0].shape # a[0, ..., 0] ã¯ a[0, :, :, 0] ã¨åŒã˜
(3, 4)
```

`...` ãŒæ˜ç¤ºçš„ã«æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã§ã‚‚ã€ indexing ã®æœ«å°¾ã«å¸¸ã«æš—é»™ã« `...` ãŒã‚ã‚‹ã¨æ€ã†ã¨è€ƒãˆã‚„ã™ã„ã§ã™ã€‚

- ä¾‹

```python
>>> a = np.ones((2, 3, 4, 5))
>>> a[0].shape # a[0] ã¯ a[0, ...] ã¾ãŸã¯ a[0, :, :, :] ã¨åŒã˜
(3, 4, 5)
```

## `None` (`np.newaxis`) ã«ã‚ˆã‚‹ indexing

`np.newaxis` ã¯ `None` ã® alias ã§ã™ã€‚

https://numpy.org/doc/2.2/reference/constants.html#numpy.newaxis

æ•´æ•°, `:`, `...` ã¯ã„ãšã‚Œã‚‚å…ƒã®ãƒ†ãƒ³ã‚½ãƒ«ã«å¯¾ã—ã¦å¯¾å¿œã™ã‚‹æ¬¡å…ƒã‚’ã‚‚ã£ã¦ã„ã¾ã—ãŸãŒã€ `np.newaxis` ã¯å°‘ã—ç•°ãªã‚Šã€å…ƒã®ãƒ†ãƒ³ã‚½ãƒ«ã¨å¯¾å¿œã—ãªã„ã‚µã‚¤ã‚º 1 ã®æ¬¡å…ƒã‚’æ–°ãŸã«å¢—ã‚„ã—ã¾ã™ã€‚

- ä¾‹

```python
>>> a = np.array([0, 1, 2])
>>> a.shape
(3,)
>>> a[:, np.newaxis].shape
(3, 1)
>>> a[np.newaxis, :].shape
(1, 3)
```

## Shape ã®æ±ºå®šãƒ—ãƒ­ã‚»ã‚¹

### æ‰‹ç¶šãçš„ãªç†è§£

ã“ã“ã§ã¯ indexing ã—ãŸçµæœã®ãƒ†ãƒ³ã‚½ãƒ«ã® shape ãŒã©ã®ã‚ˆã†ã«æ±ºã¾ã£ã¦ã„ã‚‹ã‹ã‚’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ çš„ã«èª¬æ˜ã—ã¾ã™ã€‚
ã“ã®è€ƒãˆæ–¹ã‚’ç”¨ã„ã‚‹ã¨ã€å…ƒã®ãƒ†ãƒ³ã‚½ãƒ«ã®å½¢çŠ¶ã¨ index ã®ä¸¦ã³ã•ãˆè¦‹ã‚Œã°å½¢å¼çš„ã«çµæœã®å½¢çŠ¶ã‚’è¨ˆç®—ã§ãã¾ã™ã€‚

ã¾ãŸã€è¨ˆç®—ã®éç¨‹ã§å…ƒã®é…åˆ—ã¨ã®æ¬¡å…ƒã®å¯¾å¿œãŒã‚ã‹ã‚‹ã®ã§ã€å®Ÿéš›çµæœãƒ†ãƒ³ã‚½ãƒ«ã®ã©ã®ä½ç½®ã«å…ƒã®ãƒ†ãƒ³ã‚½ãƒ«ã®ã©ã®è¦ç´ ãŒå¯¾å¿œã™ã‚‹ã‹ã¯å®¹æ˜“ã«ã‚ã‹ã‚‹ã§ã—ã‚‡ã† (å½¢å¼åŒ–ã™ã‚‹ã®ã¯å°‘ã—é¢å€’ãªã®ã§çœç•¥ã•ã›ã¦ãã ã•ã„)ã€‚

ã“ã“ã§ã¯ index ã¯ `:`, `...`, None, æ•´æ•°ã®ã¿ã‹ã‚‰ãªã‚‹ã¨ã—ã¾ã™

```
index = (index_elem (, index_elem)*)
index_elem = : | ... | None | integer
```

ã¯ã˜ã‚ã«ã€æ¬¡å…ƒã®æ•°åˆã‚ã›ã¨ `...` ã®é™¤å»ã®æ­£è¦åŒ–å‡¦ç†ã‚’è¡Œã„ã¾ã™ (å‰å‡¦ç†)ã€‚

- Index ãŒ `...` ã‚’å«ã¾ãªã„å ´åˆã€æœ«å°¾ã« `...` ã‚’è¿½åŠ ã™ã‚‹
- `...` ã‚’å¿…è¦ãªæ•°ã® `:` ã«å±•é–‹ã™ã‚‹

`...` ã‚’é™¤å»ã—ãŸå¾Œã®ã€æ®‹ã‚Šã® Shape ã®æ±ºå®šã‚’ Python é¢¨ã®ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰ã§è¡¨ã‚ã—ã¾ã™ã€‚

```python
def calc_result_shape(a: np.array, index: List[IndexElement]):
  current_dim = 0
  result_shape = []

  for index_elem in index:
    if is_integer(index_elem):
      current_dim += 1
    elif index_elem == ":":
      result_shape.append(a.shape[current_dim])
      current_dim += 1
    elif index_elem is None:
      result_shape.append(1)

  return result_shape
```

å„å¤‰æ•°ã®æ„å‘³ã¯æ¬¡ã®ã‚ˆã†ã«è€ƒãˆã¦ãã ã•ã„

- `current_dim`:ã€Œç¾åœ¨ `a` ã®ä½•ç•ªç›®ã®æ¬¡å…ƒã‚’å‡¦ç†ã—ã¦ã„ã‚‹ã‹ã€
- `result_shape`: indexing ã—ãŸçµæœã®ãƒ†ãƒ³ã‚½ãƒ«ã®å½¢çŠ¶

`current_dim += 1` ã¨ã„ã†ã®ã¯ã€`a` ã®æ¬¡å…ƒã‚’é€²ã‚ã‚‹ ("æ¶ˆè²»" ã—ã¦ã„ã‚‹) ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
`None` ã®ã¿ `a` ã®æ¬¡å…ƒã‚’æ¶ˆè²»ã›ãšã«ã€çµæœã®æ¬¡å…ƒã‚’å¢—ã‚„ã—ã¾ã™ã€‚

- ä¾‹

```python
a.shape = (10, 20, 30)
index = (:, None, 5) 

# æ­£è¦åŒ–
(:, None, 5)
-> (:, None, 5, ...)
-> (:, None, 5, :)
index = (:, None, 5, :) 

calc_result_shape:
0. result_shape = [], current_dim = 0
1. ":" -> result_shape = [10], current_dim = 1  (a.shape[0] ã‚’æ¶ˆè²»)
2. None -> result_shape = [10, 1], current_dim = 1 (a ã®æ¬¡å…ƒã¯é€²ã‚ãšã€result_shape ã« 1 ã‚’è¿½åŠ )
3. 5 -> result_shape = [10, 1], current_dim = 2 (a.shape[1] ã‚’æ¶ˆè²»ã€æ•´æ•°ãªã®ã§ result_shape ã«ã¯è¿½åŠ ã—ãªã„)
4. ":" -> result_shape = [10, 1, 30], current_dim = 3 (a.shape[2] ã‚’æ¶ˆè²»)

result_shape = [10, 1, 30]
```

### è¦–è¦šçš„ç†è§£ (è£œè¶³)

ãƒ†ãƒ³ã‚½ãƒ«ã‚’ã²ã¨ã¤ã® "ç®±" ã®ã‚ˆã†ãªã‚‚ã®ã ã¨è€ƒãˆã¦ã€ã“ã‚Œã‚’ (å¤–ã‹ã‚‰å†…ã¸) ãƒã‚¹ãƒˆã•ã›ã¦ã„ã£ã¦ãƒ†ãƒ³ã‚½ãƒ«ã‚’çµ„ã¿ç«‹ã¦ã‚‹ã‚ˆã†ãªè¦–è¦šçš„ã‚¤ãƒ¡ãƒ¼ã‚¸ã§èª¬æ˜ã—ã¦ã¿ã¾ã™ã€‚

`âµ` ã‚’æ¬¡ã«è€ƒãˆã‚‹ãƒ†ãƒ³ã‚½ãƒ«ã‚’ç¤ºã™ç®±ã®ã‚ˆã†ãªã‚‚ã®ã ã¨è€ƒãˆã¦ãã ã•ã„ã€‚
çµæœã®ãƒ†ãƒ³ã‚½ãƒ«ã¯ã¯ã˜ã‚ç©º (`âµ` 1 ã¤) ã‹ã‚‰å§‹ã¾ã£ã¦ã€ä»¥ä¸‹ã®å¤‰æ›ã‚’ç¹°ã‚Šè¿”ã—ã¦å½¢çŠ¶ãŒæ±ºã¾ã‚‹ã¨è€ƒãˆã¾ã™ã€‚

`âµ` ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã¯ã™ã¹ã¦ã® `âµ` ã‚’åŒã˜ã‚ˆã†ã«ç½®ãã‹ãˆã¾ã™ã€‚

- æ•´æ•°: `âµ -> âµ` (æ¬¡å…ƒã‚’æ¶ˆè²»)
- `:`: `âµ -> [âµ, âµ, âµ, ..., âµ]` (æ¬¡å…ƒã‚’æ¶ˆè²»)
- `None`: `âµ -> [âµ]`

- ä¾‹

```
>>> a = np.array([[0, 1, 2], [3, 4, 5]])
>>> b = a[:, np.newaxis, 2]
>>> b
array([[2],
       [5]])
>>> b.shape
(2, 1)
```

èª¬æ˜

```
## Init

index: (:, np,newaxis, 2)
a.shape: (2, 3)
b: âµ


## First (`:`) (âˆ€âµ. âµ -> [âµ, ..., âµ])

index: (:, np,newaxis, 2)
        ^
a.shape: (2, 3)
          ^
b: âµ -> b: [âµ, âµ]


## Second (`np.newaxis`) (âˆ€âµ. âµ -> [âµ])

index: (:, np,newaxis, 2)
           ^^^^^^^^^^
a.shape: (2, 3)
             ^ (not used)
b: [âµ, âµ] -> b: [[âµ], [âµ]]


## Third (`2`) (âˆ€âµ. âµ -> âµ)

index: (:, np,newaxis, 2)
                       ^
a.shape: (2, 3)
             ^
b: [[âµ], [âµ]] -> b: [[âµ], [âµ]]
```

## Broadcasting

Broadcasting ã¨ã¯ã€å½¢çŠ¶ãŒç•°ãªã‚‹é…åˆ—åŒå£«ã§ç®—è¡“æ¼”ç®—ã‚’è¡Œã†éš›ã«ã€å½¢çŠ¶ã‚’è‡ªå‹•çš„ã«åˆã‚ã›ã‚‹ä»•çµ„ã¿ã®ã“ã¨ã§ã™ã€‚

Broadcasting ã¯ã€å¯¾å¿œã™ã‚‹æ¬¡å…ƒã‚’ **å³ã‹ã‚‰å·¦ã®é †** ã§è€ƒãˆã‚‹ã¨ã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒ«ã§æ¬¡å…ƒã‚’æ‹¡å¼µã—ã¾ã™ã€‚

- å³è©°ã‚ã§æ¬¡å…ƒã®æ•°ã‚’åˆã‚ã›ã‚‹ (ã‚‚ã¨ã‚‚ã¨ç„¡ã„éƒ¨åˆ†ã¯ 1 ã¨è€ƒãˆã‚‹)
- å„æ¬¡å…ƒã®å¤§ãã•ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®ã©ã¡ã‚‰ã‹ãŒæº€ãŸã•ã‚Œã‚‹ã¨ãå°ã•ããªã„ã»ã†ã«åˆã‚ã›ã‚‹
  - a. å€¤ãŒä¸€è‡´ã™ã‚‹
  - b. ç‰‡æ–¹ãŒ 1

å¯¾å¿œã™ã‚‹æ¬¡å…ƒã«ã¤ã„ã¦ a, b ã©ã¡ã‚‰ã‚‚æº€ãŸã•ã‚Œãªã„å ´åˆã¯ `ValueError` ã¨ãªã‚Šã¾ã™ã€‚

- Shape ã®ä¾‹

```
A = np.random.random((8, 1, 6, 5))
B = np.random.random((7, 1, 5))
Result = A + B

A      (4d array):  8 x 1 x 6 x 5
B      (3d array):      7 x 1 x 5
Result (4d array):  8 x 7 x 6 x 5
```

æ¬¡å…ƒã‚’ 1 ã‹ã‚‰å¤§ãã„ã»ã†ã«åˆã‚ã›ã¦æ‹¡å¼µã™ã‚‹éš›ã«ã¯ã€è«–ç†çš„ã«ãã®æ¬¡å…ƒã®è¦ç´ ã‚’è¤‡è£½ã—ã¦è¨ˆç®—ã«ä½¿ã„ã¾ã™ã€‚
`np.newaxis` ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ outer product ç­‰ã‚’ç°¡å˜ã«è¡¨ç¾ã§ãã¾ã™ã€‚

```python
>>> import numpy as np
>>> a = np.array([1, 2, 3])
>>> b = np.array([4, 5])

>>> a[:, np.newaxis] * b
array([[ 4,  5],
       [ 8, 10],
       [12, 15]])

>>> np.outer(a, b)  # equivalent
array([[ 4,  5],
       [ 8, 10],
       [12, 15]])
```

## Quiz

æœ€å¾Œã« indexing, broadcasting ã«ã¤ã„ã¦ç°¡å˜ãª quiz ã‚’å‡ºé¡Œã—ã¾ã™ã€‚ç­”ãˆã¯æŠ˜ã‚Šç•³ã¿ã®ä¸­ã«ã‚ã‚Šã¾ã™ã€‚

- Shape ã®ã¿

çµæœã®ãƒ†ãƒ³ã‚½ãƒ«ã® shape ã‚’ç­”ãˆã¦ãã ã•ã„ã€‚

Q1. `np.ones((10, 20, 30))[5, ..., 0].shape`
Q2. `np.ones((2, 3, 4))[:, None, :, 0].shape`
Q3. `(np.ones((5, 1, 4)) + np.ones((3, 4))).shape`

:::details ç­”ãˆ

A1. `(20,)`
A2. `(2, 1, 3)`
A3. `(5, 3, 4)`
:::

- å€¤ã¤ã

Q. `res` ã®ä¸­èº«ã¯?

```python
>>> a = np.arange(24).reshape(2, 3, 4)
>>> a
array([[[ 0,  1,  2,  3],
        [ 4,  5,  6,  7],
        [ 8,  9, 10, 11]],

       [[12, 13, 14, 15],
        [16, 17, 18, 19],
        [20, 21, 22, 23]]])
>>> b = np.array([10, 20])
>>> b
array([10, 20])
>>> res = a[0, ..., 1, np.newaxis] + b  # res = ???
```

:::details ç­”ãˆ

```
>>> res
array([[11, 21],
       [15, 25],
       [19, 29]])
```

è§£èª¬

```
a.shape = (2, 3, 4)

a[0, ..., 1, np.newaxis].shape = (3, 1)
a[0, ..., 1, np.newaxisa] (= a'):
array([[1],
       [5],
       [9]])

b.shape = (2,)
b: array([10, 20])

a' : 3 x 1
b  :     2
res: 3 x 2
```

:::
